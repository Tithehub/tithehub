<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>TitheHub — Donate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; }
    .wrap { max-width: 960px; margin: 0 auto; padding: 24px; }
    .card { border:1px solid #eee; border-radius:16px; padding:24px; box-shadow:0 6px 24px rgba(0,0,0,.06); }
    .grid { display:grid; gap:16px; grid-template-columns: 1fr; }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .btn { display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid #ccc; text-decoration:none; }
    img.qr { width:100%; max-width:360px; border-radius:10px; }
    @media (min-width: 800px){ .grid { grid-template-columns: 1fr 360px; } }
  </style>
</head>
<!-- slug-normalize:start -->
<script>
(function () {
  try {
    var parts = (window.location.pathname || "").split("/").filter(Boolean);
    var last  = parts.pop() || "";
    if (/^index(.html?)?$/i.test(last)) last = parts.pop() || last;  // /donate/slug/index.html
    var normalized = String(last).replace(/.html?$/i, "");           // drop .html
    window.TH_SLUG = normalized;
    window.slug    = normalized; // expose legacy global if page expects "slug"
    console.log("[tithehub] slug =", normalized);
  } catch (e) {
    console.error("[tithehub] slug-normalize error", e);
  }
})();
</script>
<!-- slug-normalize:end -->
<!-- slug-fix:start --><script>(function(){try{var p=window.location.pathname.split("/").filter(Boolean);var last=p.pop()||"";if(/^index(.html)?$/i.test(last)){last=p.pop()||last;}var slug=String(last).replace(/.html$/i,"");window.TH_SLUG=slug;}catch(e){console.error("slug-fix",e);}})();</script><!-- slug-fix:end -->
<body>
  <div class="wrap">
    <div class="card">
      <div id="content" class="grid">
        <div>
          <h1 id="orgName">Loading…</h1>
          <p id="orgDesc">Please wait while we load this organization.</p>
          <div class="row" id="ctaRow"></div>
          <h3>Crypto addresses</h3>
          <ul id="cryptoList"></ul>
        </div>
        <div>
          <img id="qrImg" class="qr" alt="Donation QR"/>
        </div>
      </div>
    </div>
  </div>

  <script>
    (async function(){
      const parts = location.pathname.replace(/\/+$/,'').split('/donate/');
      const base = parts[0];
      const slug = (parts[1]||'').split('/').pop();
      const jsonUrl = base + '/orgs/' + slug + '.json';
      try{
        const org = await (await fetch(jsonUrl, {cache:'no-store'})).json();
        document.title = 'Donate — ' + (org.name || slug);
        document.getElementById('orgName').textContent = org.name || slug;
        document.getElementById('orgDesc').textContent = org.notes || 'Support our mission.';
        document.getElementById('qrImg').src = org.qrUrl;

        const row = document.getElementById('ctaRow');
        function btn(href, text){
          const a = document.createElement('a');
          a.className='btn';
          a.href=href; a.target='_blank'; a.rel='noopener'; a.textContent=text;
          row.appendChild(a);
        }
        if(org.stripeMonthlyLink) btn(org.stripeMonthlyLink, 'Give Monthly');
        if(org.stripeAnnualLink) btn(org.stripeAnnualLink, 'Give Annually');
        if(org.orgWebsite) btn(org.orgWebsite, 'Visit Website');

        const ul = document.getElementById('cryptoList');
        for(const [k,v] of Object.entries(org.crypto || {})){
          if(!v) continue;
          const li = document.createElement('li');
          li.textContent = k + ': ' + v;
          ul.appendChild(li);
        }
      }catch(e){
        document.getElementById('orgName').textContent = 'Not Found';
        document.getElementById('orgDesc').textContent = 'This donation page does not exist.';
      }
    })();
  </script>
</body>
</html>
